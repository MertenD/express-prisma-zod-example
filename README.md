# Express + Prisma + Zod + TypeScript Starter

A minimal but well-structured REST API starter using:

- **Node.js + Express**
- **TypeScript**
- **Prisma** (with **PostgreSQL**)
- **Zod** for request validation

Example resource: `Post`  
Endpoints:

- `GET /api/posts`
- `POST /api/posts`

---

## 1. Prerequisites

You’ll need:

- **Node.js** (LTS recommended, e.g. 20.x)
- **npm**
- **PostgreSQL** running locally or in the cloud

---

## 2. Project Setup

### 2.1 Clone & install dependencies

```bash
git clone <this-repo-url>
cd express-prisma-zod-example

npm install
```

### 2.1 Environment Variables

The app uses a `.env` file for configuration and validates it with Zod.

Create a `.env` file based on the `.env.example` file in the project root and replace the example values with your actual values, especially the postgres url.

```bash
cp .env.example .env
```

### 3.1 Run initial Prisma migrations

This will create the database schema in your PostgreSQL database:

```bash
npx prisma migrate dev --name init
```

### 3.2 Generate Prisma Client

(Usually done automatically with `migrate dev`, but you can run it manually:)

```bash
npx prisma generate
```

This will generate the needed `/src/generated` directory with the prisma adapter. Using this adapter will guarantee type safety.

---

## 3. Scripts

Defined in `package.json`:

```json
{
  "scripts": {
    "dev": "ts-node-dev --respawn --transpile-only src/server.ts",
    "build": "tsc",
    "start": "node dist/server.js",
    "prisma:migrate": "prisma migrate dev",
    "prisma:generate": "prisma generate"
  }
}
```

### 3.1 Development

```bash
npm run dev
```

The server will start on:

```text
http://localhost:3000
```

(or whatever you set as `PORT` in `.env`)

### 3.2 Build for production

```bash
npm run build
npm start
```

* `npm run build` compiles TypeScript to `dist/`
* `npm start` runs the compiled JavaScript

---

## 4. Project Structure

```text
src/
├─ app.ts                   # Express app (registers middleware & routes)
├─ server.ts                # Boots the HTTP server
├─ config/
│  └─ env.ts                # Zod-validated environment variables
├─ db/
│  └─ prisma.ts             # PrismaClient singleton
├─ middleware/
│  ├─ validateRequest.ts    # Zod validation for request bodies
│  ├─ errorHandler.ts       # Global error handler
│  └─ notFound.ts           # 404 handler
├─ modules/
│  └─ posts/
│     ├─ post.schema.ts     # Zod schemas & types for Post
│     ├─ post.service.ts    # DB access / business logic
│     └─ post.controller.ts # /api/posts router and usage of service functions
prisma/
├─ schema.prisma            # Prisma schema (PostgreSQL)
├─ migrations/              # Generated by Prisma
```

---

## 5. API Usage

### 5.1 `GET /api/posts`

Returns all posts ordered by `createdAt` (descending).

```bash
curl http://localhost:3000/api/posts
```

**Response example:**

```json
[
  {
    "id": 1,
    "title": "My first post",
    "content": "Hello world",
    "createdAt": "2025-01-01T12:00:00.000Z"
  }
]
```

### 5.2 `POST /api/posts`

Creates a new post. Request body is validated with **Zod**:

```ts
// createPostSchema
{
  title: string (min length 3),
  content?: string
}
```

**Example:**

```bash
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -d '{"title": "My first post", "content": "Hello World!"}'
```

**Validation error example:**

```json
{
  "message": "Validation error",
  "errors": {
    "fieldErrors": {
      "title": ["Title must be at least 3 characters long"]
    },
    "formErrors": []
  }
}
```

